<!DOCTYPE html>

<html
  lang="en"
  class="layout-menu-fixed layout-compact"
  data-assets-path="/static/assets/"
  data-template="vertical-menu-template-free">
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0" />
    
    <!-- Force HTTPS for all requests -->
    <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">

    <title>üëª Ghost Gym V0.4.1 - Home</title>

    <meta name="description" content="Professional workout program management with Ghost Gym V0.4.1" />

    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="/static/assets/img/favicon/favicon.ico" />

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Public+Sans:ital,wght@0,300;0,400;0,500;0,600;0,700;1,300;1,400;1,500;1,600;1,700&display=swap"
      rel="stylesheet" />

    <link rel="stylesheet" href="/static/assets/vendor/fonts/iconify-icons.css" />

    <!-- Core CSS -->
    <link rel="stylesheet" href="/static/assets/vendor/css/core.css" />
    <link rel="stylesheet" href="/static/assets/css/demo.css" />

    <!-- Vendors CSS -->
    <link rel="stylesheet" href="/static/assets/vendor/libs/perfect-scrollbar/perfect-scrollbar.css" />

    <!-- Custom Ghost Gym CSS -->
    <link rel="stylesheet" href="/static/assets/css/ghost-gym-custom.css" />
    
    <!-- Navbar CSS -->
    <link rel="stylesheet" href="/static/assets/css/navbar-custom.css" />
    
    <!-- Landing Page CSS -->
    <link rel="stylesheet" href="/static/assets/css/landing-page.css" />

    <!-- Helpers -->
    <script src="/static/assets/vendor/js/helpers.js"></script>
    <script src="/static/assets/js/config.js"></script>

    <!-- Theme Manager (must load early to prevent flash) -->
    <script src="/static/assets/js/services/theme-manager.js"></script>

    <!-- Ghost Gym Centralized Configuration -->
    <script src="/static/assets/js/app-config.js"></script>
    
    <!-- Firebase SDK Loader (Centralized) -->
    <script type="module" src="/static/assets/js/firebase-loader.js"></script>
  </head>

  <body>
    
    <!-- Layout wrapper -->
    <div class="layout-wrapper layout-content-navbar">
      <div class="layout-container">
        <!-- Menu -->
        <aside id="layout-menu" class="layout-menu menu-vertical menu bg-menu-theme">
          <!-- Menu will be injected by menu-injection-service.js -->
        </aside>
        <!-- / Menu -->

        <!-- Layout container -->
        <div class="layout-page">

          <!-- Content wrapper -->
          <div class="content-wrapper">
            <!-- Content -->
            <div class="container-xxl flex-grow-1 container-p-y">
              
              <!-- Alert Container -->
              <div id="alertContainer" class="mb-3"></div>

              <!-- Authenticated User Dashboard -->
              <div id="authenticatedDashboard" style="display: none;">
                <!-- Statistics Cards -->
                <div class="row g-3 mb-4">
                  <!-- Workouts Card -->
                  <div class="col-md-4">
                    <div class="card h-100">
                      <div class="card-body">
                        <div class="d-flex justify-content-between align-items-start mb-3">
                          <div class="avatar flex-shrink-0">
                            <span class="avatar-initial rounded bg-label-primary">
                              <i class="bx bx-dumbbell bx-md"></i>
                            </span>
                          </div>
                          <div class="dropdown">
                            <button class="btn p-0" type="button" data-bs-toggle="dropdown">
                              <i class="bx bx-dots-vertical-rounded"></i>
                            </button>
                            <div class="dropdown-menu dropdown-menu-end">
                              <a class="dropdown-item" href="workout-builder.html">
                                <i class="bx bx-show me-2"></i>View All
                              </a>
                              <a class="dropdown-item" href="workout-builder.html">
                                <i class="bx bx-plus me-2"></i>Create New
                              </a>
                            </div>
                          </div>
                        </div>
                        <span class="fw-semibold d-block mb-1">Workouts</span>
                        <h3 class="card-title mb-2" id="workoutsCount">0</h3>
                        <small class="text-success fw-semibold">
                          <a href="workout-builder.html" class="text-decoration-none">
                            <i class="bx bx-right-arrow-alt"></i> Manage workouts
                          </a>
                        </small>
                      </div>
                    </div>
                  </div>

                  <!-- Programs Card -->
                  <div class="col-md-4">
                    <div class="card h-100">
                      <div class="card-body">
                        <div class="d-flex justify-content-between align-items-start mb-3">
                          <div class="avatar flex-shrink-0">
                            <span class="avatar-initial rounded bg-label-success">
                              <i class="bx bx-folder bx-md"></i>
                            </span>
                          </div>
                          <div class="dropdown">
                            <button class="btn p-0" type="button" data-bs-toggle="dropdown">
                              <i class="bx bx-dots-vertical-rounded"></i>
                            </button>
                            <div class="dropdown-menu dropdown-menu-end">
                              <a class="dropdown-item" href="programs.html">
                                <i class="bx bx-show me-2"></i>View All
                              </a>
                              <a class="dropdown-item" href="programs.html">
                                <i class="bx bx-plus me-2"></i>Create New
                              </a>
                            </div>
                          </div>
                        </div>
                        <span class="fw-semibold d-block mb-1">Programs</span>
                        <h3 class="card-title mb-2" id="programsCount">0</h3>
                        <small class="text-success fw-semibold">
                          <a href="programs.html" class="text-decoration-none">
                            <i class="bx bx-right-arrow-alt"></i> Manage programs
                          </a>
                        </small>
                      </div>
                    </div>
                  </div>

                  <!-- Exercises Card -->
                  <div class="col-md-4">
                    <div class="card h-100">
                      <div class="card-body">
                        <div class="d-flex justify-content-between align-items-start mb-3">
                          <div class="avatar flex-shrink-0">
                            <span class="avatar-initial rounded bg-label-info">
                              <i class="bx bx-list-ul bx-md"></i>
                            </span>
                          </div>
                          <div class="dropdown">
                            <button class="btn p-0" type="button" data-bs-toggle="dropdown">
                              <i class="bx bx-dots-vertical-rounded"></i>
                            </button>
                            <div class="dropdown-menu dropdown-menu-end">
                              <a class="dropdown-item" href="exercise-database.html">
                                <i class="bx bx-show me-2"></i>Browse Database
                              </a>
                            </div>
                          </div>
                        </div>
                        <span class="fw-semibold d-block mb-1">Exercises</span>
                        <h3 class="card-title mb-2" id="exercisesCount">0</h3>
                        <small class="text-success fw-semibold">
                          <a href="exercise-database.html" class="text-decoration-none">
                            <i class="bx bx-right-arrow-alt"></i> Browse database
                          </a>
                        </small>
                      </div>
                    </div>
                  </div>
                </div>

                <!-- Quick Actions -->
                <div class="card mb-4">
                  <div class="card-header">
                    <h5 class="card-title mb-0">
                      <i class="bx bx-rocket me-2"></i>Quick Actions
                    </h5>
                  </div>
                  <div class="card-body">
                    <div class="row g-3">
                      <div class="col-md-4">
                        <a href="workout-builder.html" class="btn btn-outline-primary w-100 d-flex align-items-center justify-content-center" style="height: 80px;">
                          <div class="text-center">
                            <i class="bx bx-plus-circle bx-lg d-block mb-2"></i>
                            <span>Create Workout</span>
                          </div>
                        </a>
                      </div>
                      <div class="col-md-4">
                        <a href="programs.html" class="btn btn-outline-success w-100 d-flex align-items-center justify-content-center" style="height: 80px;">
                          <div class="text-center">
                            <i class="bx bx-folder-plus bx-lg d-block mb-2"></i>
                            <span>Create Program</span>
                          </div>
                        </a>
                      </div>
                      <div class="col-md-4">
                        <a href="exercise-database.html" class="btn btn-outline-info w-100 d-flex align-items-center justify-content-center" style="height: 80px;">
                          <div class="text-center">
                            <i class="bx bx-search bx-lg d-block mb-2"></i>
                            <span>Browse Exercises</span>
                          </div>
                        </a>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Unauthenticated Landing Page -->
              <div id="unauthenticatedWelcome" style="display: none;">
                
                <!-- Hero Card -->
                <div class="card landing-hero-card mb-4">
                  <div class="card-body text-center py-5">
                    <h1 class="mb-2">
                      <i class="bx bx-dumbbell me-2"></i>
                      Ghost Gym
                    </h1>
                    <p class="text-muted mb-0">Create and manage your workout programs</p>
                  </div>
                </div>

                <!-- Feature Steps Section -->
                <div class="row g-4 mb-4">
                  
                  <!-- Step 1: Start with a workout (Clickable) -->
                  <div class="col-12">
                    <a href="workout-builder.html" class="card landing-feature-card landing-feature-link">
                      <div class="card-body">
                        <div class="landing-feature-content">
                          <div class="landing-feature-text">
                            <h5 class="mb-1">Start with a workout</h5>
                            <p class="text-muted small mb-0">Create your first workout template with exercises, sets, and reps</p>
                          </div>
                          <div class="landing-feature-icon">
                            <i class="bx bx-dumbbell"></i>
                          </div>
                        </div>
                      </div>
                    </a>
                  </div>

                  <!-- Step 2: Build into programs (Clickable) -->
                  <div class="col-12">
                    <a href="programs.html" class="card landing-feature-card landing-feature-link">
                      <div class="card-body">
                        <div class="landing-feature-content">
                          <div class="landing-feature-text">
                            <h5 class="mb-1">Build into programs</h5>
                            <p class="text-muted small mb-0">Combine multiple workouts to create complete training programs</p>
                          </div>
                          <div class="landing-feature-icon">
                            <i class="bx bx-folder"></i>
                          </div>
                        </div>
                      </div>
                    </a>
                  </div>

                  <!-- Step 3: Share with friends (Not clickable) -->
                  <div class="col-12">
                    <div class="card landing-feature-card">
                      <div class="card-body">
                        <div class="landing-feature-content">
                          <div class="landing-feature-text">
                            <h5 class="mb-1">Share with friends</h5>
                            <p class="text-muted small mb-0">Export and share your programs with training partners</p>
                          </div>
                          <div class="landing-feature-icon">
                            <i class="bx bx-share-alt"></i>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>

                </div>

                <!-- CTA Card -->
                <div class="card landing-cta-card">
                  <div class="card-body text-center py-4">
                    <h5 class="mb-3">Ready to start?</h5>
                    <p class="text-muted mb-4">Sign in to save your workouts and access them anywhere</p>
                    <button class="btn btn-primary" onclick="showAuthModal('signin')">
                      <i class="bx bx-log-in me-2"></i>Sign In
                    </button>
                    <div class="mt-3">
                      <small class="text-muted">
                        Don't have an account?
                        <a href="#" onclick="showAuthModal('signup'); return false;" class="text-decoration-none">
                          <strong>Sign up free</strong>
                        </a>
                      </small>
                    </div>
                  </div>
                </div>

              </div>

            </div>
            <!-- / Content -->

            <div class="content-backdrop fade"></div>
          </div>
          <!-- Content wrapper -->
        </div>
        <!-- / Layout page -->
      </div>

      <!-- Overlay -->
      <div class="layout-overlay layout-menu-toggle"></div>
    </div>
    <!-- / Layout wrapper -->

    <!-- Core JS -->
    <script src="/static/assets/vendor/libs/jquery/jquery.js"></script>
    <script src="/static/assets/vendor/libs/popper/popper.js"></script>
    <script src="/static/assets/vendor/js/bootstrap.js"></script>
    <script src="/static/assets/vendor/libs/perfect-scrollbar/perfect-scrollbar.js"></script>
    <script src="/static/assets/vendor/js/menu.js"></script>

    <!-- Load templates FIRST -->
    <script src="/static/assets/js/components/menu-template.js"></script>
    <script src="/static/assets/js/components/navbar-template.js"></script>
    <script src="/static/assets/js/components/auth-modals-template.js"></script>
    
    <!-- Inject components SECOND -->
    <script src="/static/assets/js/services/menu-injection-service.js"></script>
    <script src="/static/assets/js/services/navbar-injection-service.js"></script>

    <!-- Main JS -->
    <script src="/static/assets/js/main.js"></script>

    <!-- Firebase Services -->
    <script src="/static/assets/js/firebase/firebase-init.js?v=20251020-03"></script>
    <script src="/static/assets/js/firebase/auth-service.js?v=20251020-03"></script>
    <script src="/static/assets/js/firebase/auth-ui.js?v=20251020-03"></script>
    <script src="/static/assets/js/firebase/data-manager.js?v=20251020-05"></script>

    <!-- Common Utilities (MUST load before other dashboard scripts) -->
    <script src="/static/assets/js/utils/common-utils.js"></script>

    <!-- UI Helpers -->
    <script src="/static/assets/js/dashboard/ui-helpers.js?v=20251020-04"></script>

    <!-- Menu Navigation System -->
    <script src="/static/assets/js/menu-navigation.js?v=20251020-04"></script>

    <!-- Home Page Script -->
    <script>
        // Initialize home page
        async function initHomePage() {
            console.log('üè† Initializing Home Page...');
            
            const authenticatedDashboard = document.getElementById('authenticatedDashboard');
            const unauthenticatedWelcome = document.getElementById('unauthenticatedWelcome');
            
            // Wait for Firebase to be ready
            if (!window.firebaseReady) {
                await new Promise(resolve => {
                    window.addEventListener('firebaseReady', resolve, { once: true });
                });
            }
            
            // Wait for data manager
            if (!window.dataManager) {
                console.error('‚ùå Data manager not available');
                return;
            }
            
            // Check auth state
            const checkAuthAndRender = async () => {
                const user = window.firebaseAuth.currentUser;
                
                if (user) {
                    // User is authenticated - show dashboard
                    console.log('‚úÖ User authenticated, showing dashboard');
                    authenticatedDashboard.style.display = 'block';
                    unauthenticatedWelcome.style.display = 'none';
                    
                    // Update user display name
                    const displayNameEl = document.getElementById('userDisplayName');
                    if (displayNameEl) {
                        displayNameEl.textContent = user.displayName || user.email || 'User';
                    }
                    
                    // Load and display statistics
                    await loadStatistics();
                } else {
                    // User is not authenticated - show welcome page
                    console.log('‚ÑπÔ∏è User not authenticated, showing welcome page');
                    authenticatedDashboard.style.display = 'none';
                    unauthenticatedWelcome.style.display = 'block';
                }
            };
            
            // Initial check
            await checkAuthAndRender();
            
            // Listen for auth state changes
            window.firebaseAuth.onAuthStateChanged(async (user) => {
                console.log('üîÑ Auth state changed:', user ? 'authenticated' : 'not authenticated');
                await checkAuthAndRender();
            });
            
            console.log('‚úÖ Home page initialized');
        }
        
        // Load statistics
        async function loadStatistics() {
            try {
                console.log('üìä Loading statistics...');
                
                // Load data
                const [workouts, programs] = await Promise.all([
                    window.dataManager.getWorkouts(),
                    window.dataManager.getPrograms()
                ]);
                
                // Update counts
                document.getElementById('workoutsCount').textContent = workouts.length;
                document.getElementById('programsCount').textContent = programs.length;
                
                // Exercise count (from database - approximate)
                document.getElementById('exercisesCount').textContent = '800+';
                
                console.log('‚úÖ Statistics loaded:', {
                    workouts: workouts.length,
                    programs: programs.length
                });
            } catch (error) {
                console.error('‚ùå Error loading statistics:', error);
            }
        }
        
        // Initialize when DOM is ready
        document.addEventListener('DOMContentLoaded', initHomePage);
        
        // Make functions globally available
        window.initHomePage = initHomePage;
        window.loadStatistics = loadStatistics;
    </script>
  </body>
</html>
